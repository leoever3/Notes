### Database performance tuning and query optimization

* Set of activities and procedures designed to **reduce response time** of database system
* Client side: Generate SQL query that returns correct answer in least amount of time
  * Using minimum amount of resources at server
  * SQL performance tuning
* Server side: DBMS environment configured to respond to clientsâ€™ requests as fast as possible
  * Optimum use of existing resources
  * DBMS performance tuning

![image-20211206002859737](/Users/morningstar/Library/Application Support/typora-user-images/image-20211206002859737.png)

#### Database performance tuning

##### **DBMS architecture**

* **DBMS architecture** is represented by processes and structures used to manage a database

* All data in database are stored in **data files**
* **<u>SQL structure</u>**
  * **User -- SQl -- RDBMS -- OS File System -- Data**
* cache
  * Data cache or buffer cache:
    * Stores most recently accessed data blocks in RAM
  * SQL cache or procedure cache:
  * Permanent storage
    * DBMS retrives data from permanent storage to RAM
* Input/output request

##### Database query optimization

* Automatic query optimization
* Manual query optimization
* Static query optimization -- compiler time
  * uses statistical information about the database
* Dynamic query optimization -- execution time

##### Databse statistics

* refers to measurements gathered by the DBMS Describe snapshot of database objects' **characteristics**

![image-20211206005023831](/Users/morningstar/Library/Application Support/typora-user-images/image-20211206005023831.png)

#### SQL performance tuning

* activities on clint side to generate SQL code
* SQL performance tuning deals with writing queries that make good use of statistics

##### Query processing

* **Parsing**: DBMS parses(analyze) the query and chooses the most efficient access/execution plan
  * Break down query into smaller units
  * Transform original SQL query into more efficient one
  * Check if **access plan** already exists
* **Execution**: DBMS executes the query using chosen execution plan
  * All I/O operations indicated in access plan are executed
* **Fetching**: DBMS fetches the data and sends the result back to the client

* Bottlenecks:
  * CPU
  * RAM
  * Hard disk
  * Network
  * Application code

##### Index

* Speeding up data access
* More efficient to use index to access table than to scan all rows in table sequentially

* **Data sparsity**
  * number of different values a column could possibly have
* Indexes implemented
  * Hash indexes
  * B-tree index
  * Bitmap index
* During query optimization DBMS chooses indexs to use, how to perform join operations, table to use first
* Optimizer choices
  * **Rule-based** optimizer
  * **Cost-based** optimizer: statistics
  * Hints change optimizer mode for current SQL statement

##### Writing SQL code

* Index selectivity
  * WHERE / HAVING
  * GROUP BY / ORDER BY
  * MAX / MIN
  * Data sparsity on indexed column is high
  * PK / FK have indexes
  * Declare indexes in join columns
* Conditional Expression
* Query Formulation
  * Deals with translating business questions into specific SQL code