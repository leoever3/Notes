### <u>Why database?</u>

File storage are the first version. They are rapidly getting very largeand thus searching for an information is **resource consuming**. Therefore, developers and research communities identify the need for an **optimal query languages** and thus they introduced **databases**.

* **Relational databases**
* Tabulet
* Provide **index**

##### Common Data Sorage Formats

* scheme
  * CSV,TSV
  * Relational Formats (SQL)
* No scheme
  * XML
  * JSON  (nested data)

#### History of database

* Hierarchical Models
* **Relational Databases(SQL)** when we have a specific **schema**
  * the need for **scheme**
  * performance challenges with **large** data
  * high cost
  * lack of **dynamic** models
* **Document Databases(NoSQL)** when we are dealing with heterogenous data
* Graph Databases: when we need to keep **many-to-many** relationships

### Relational Database

* Many-to-one realationship
* **SQL**
* normalize from many-to-many into one-to-many

### MySQL

#### **Prepare in terminal**

```bash
$ mysql -u root -p

mysql> create database met520;

show databases;

use met520;

create table HW5 (bullet_point VARCHAR(20), category VARCHAR(100), category_url VARCHAR(200), clickthrough_url VARCHAR(200), close_date DATE, currency VARCHAR(20));

show tables;

describe HW5;
```

#### Prepare in Eclipse

Add mysql-connector-java

Project -> property -> java build path ->libraries -> Add external JARs

**Issues:**

Get the year from the date: year()

"select * from HW5 where year(close_date) = '"+date+"'"

### Codes Example

```java
package jdbc;

import java.io.*;
import java.sql.*;

public class Insert_Retrive {
	public static void main(String[] args) {
		String searchFile = "/Users/morningstar/Desktop/HM4/merge.csv";
		BufferedReader input = null;
		String line = "";
		try {
			input = new BufferedReader(new FileReader(searchFile));
			while ((line = input.readLine()) != null) {
				insert(line);
			}
			retriveEverything();
			//deleteEverything();
		} catch (FileNotFoundException e ) {
            e.printStackTrace();
        } catch (IOException e ) {
            e.printStackTrace();
        } finally {
        	try {
	        	input.close();
        	} catch (IOException e ) {
        		e.printStackTrace();
        	} 
        }
	}
	
	public static void insert(String line) {
		String[] lineArray = line.split(","); // split the line by ","
		lineArray[4] = lineArray[4].substring(0,10); //get the exact date
		
		try {
			Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/met520?useTimezone=true&serverTimezone=UTC","root","19961214wtx");
			System.out.println("--->"+con.toString());
			Statement stmt = con.createStatement();
			System.out.println("----->"+ "INSERT INTO HW5(bullet_point, category, category_url, clickthrough_url, close_date, currency) VALUES(‘"+lineArray[0]+"',‘"+lineArray[1]+"',‘"+lineArray[2]+"','"+lineArray[3]+"','"+lineArray[4]+"','"+lineArray[5]+"')");
			stmt.executeUpdate("INSERT INTO HW5(bullet_point, category, category_url, clickthrough_url, close_date, currency) VALUES('"+lineArray[0]+"','"+lineArray[1]+"','"+lineArray[2]+"','"+lineArray[3]+"','"+lineArray[4]+"','"+lineArray[5]+"')");
			con.close();
		}catch (Exception ex) {
			ex.printStackTrace();
		}
		
	}
	
	public static void retriveEverything() {
		try {
			Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/met520?useTimezone=true&serverTimezone=UTC","root", "19961214wtx");
			System.out.println("--->"+con.toString());
			Statement stmt=con.createStatement();
			ResultSet rs=stmt.executeQuery("select * from HW5");
			while(rs.next()) {
					System.out.println("row:"+rs.getString(1)+","+ rs.getString(2)+","+rs.getString(3)+","+rs.getString(4)+","+rs.getString(5)+","+rs.getString(6));
			}
			con.close();
		} catch (Exception ex) {
				ex.printStackTrace();
		}
		
	}
	public static void deleteEverything() {
		try {
			Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/met520?useTimezone=true&serverTimezone=UTC","root","19961214wtx");
			System.out.println("--->"+con.toString());
			Statement stmt = con.createStatement();
			System.out.println("DELETE EVERYTHING FROM HW5");
			stmt.executeUpdate("DELETE FROM HW5");
			con.close();
		 } catch (Exception ex) {
			 ex.printStackTrace();
		 }
	}	
}
```

